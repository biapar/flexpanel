/*
 * jQuery FlexPanel v1
 * https://github.com/dcooney/flexpanel
 *
 * Copyright 2013 Connekt Media - http://cnkt.ca/flexpanel
 * Free to use under the GPLv2 license.
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * Author: Darren Cooney
 * Twitter: @KaptonKaos
 */

(function(e){"use strict";e.flexpanel=function(t,n){var r={direction:"right",wrapper:"#wrapper",button:".flex-btn",maxWidth:null,delay:250,speed:500};var n=e.extend(r,n);var i=e(t),s=n.direction,o=e(n.wrapper),u=e(n.button),a=n.maxWidth,f=n.delay,l=n.speed,c=e(window).width(),h=e(window).height(),p=navigator.userAgent.match(/iemobile|android|webos|iphone|ipad|ipod|blackberry|bb10/i)?true:false;var d={init:function(){e("body").addClass("flexpanel-"+s);i.append('<div class="cover"/>');u.addClass("in-view");if(a===null||c<=a){d.height();i.delay(250).fadeIn(250)}if(e.fn.hammer&&p){d.touch()}},slide:function(t){switch(t){case"open":e("body").addClass("flexpanel-active");break;case"close":e(".viewport",i).animate({scrollTop:0},500);e("body").removeClass("flexpanel-active");e(document).on("touchmove",function(e){return true});break;default:if(e("body").hasClass("flexpanel-active")){e(".viewport",i).animate({scrollTop:0},500);e("body").removeClass("flexpanel-active");e(document).on("touchmove",function(e){return true})}else{e("body").addClass("flexpanel-active")}}},touch:function(){e(".cover").add(u).hammer().on("swipe, drag",function(t){switch(s){case"right":if(t.gesture.direction==="right"&&e("body").hasClass("flexpanel-active")){d.slide()}break;case"left":if(t.gesture.direction==="left"&&e("body").hasClass("flexpanel-active")){d.slide()}break;case"top":if(t.gesture.direction==="up"&&e("body").hasClass("flexpanel-active")){d.slide()}break}});u.hammer().on("swipe, drag",function(t){switch(s){case"right":if(t.gesture.direction==="left"&&!e("body").hasClass("flexpanel-active")){d.slide()}break;case"left":if(t.gesture.direction==="right"&&!e("body").hasClass("flexpanel-active")){d.slide()}break}});if(s==="top"){u.hammer().on("swipe, drag",function(t){if(t.gesture.direction==="down"&&!e("body").hasClass("flexpanel-active")){d.slide()}})}if(s==="left"||s==="right"){var t=/iemobile/i.test(navigator.userAgent.toLowerCase());if(!t){e("body").hammer().on("dragdown",function(e){if(e.gesture.deltaTime>50){u.addClass("in-view")}});e("body").hammer().on("dragup",function(t){var n=e(window).scrollTop();if(t.gesture.deltaTime>50&&n>100){u.removeClass("in-view")}})}}},height:function(){var t=h-h/4;switch(s){case"top":if(!i.hasClass("ready")){i.delay(1e3).queue(function(){i.addClass("ready")})}i.css("height",t+"px");e(".viewport",i).css("height",t+"px");e(".cover",i).css("height",t+"px");break;default:if(p){i.css("height",h+60+"px");e(".viewport",i).css("height",h+60+"px");e(".cover",i).css("height",h+60+"px")}else{i.css("height",h+"px");e(".viewport",i).css("height",h+"px");e(".cover",i).css("height",h+"px")}break}}};d.init();u.click(d.slide);e("ul li a",i).click(function(){var t=e(this);var n=t.attr("href");if(t.hasClass("anchor")){d.slide();var r=e(n).offset();var i=r.top;e("html, body").animate({scrollTop:i},l)}});i.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend",function(){var t=e(".viewport",i);if(e("body").hasClass("flexpanel-active")){t.addClass("smooth")}else{t.removeClass("smooth")}});e(window).resize(function(){v(function(){c=e(window).width();h=e(window).height();if(a===null){d.height()}else{if(c<=a){d.height()}if(c>a){if(e("body.flexpanel-active"))e("body").removeClass("flexpanel-active")}else{}}},f)});var v=function(){var e=0;return function(t,n){clearTimeout(e);e=setTimeout(t,n)}}();e(window).scroll(function(){var t=e(window).scrollTop();if(t<100){u.addClass("in-view")}});e(document).on("touchmove",function(t){if(e("body").hasClass("flexpanel-active")){t.preventDefault()}});e("body").on("touchstart",".viewport",function(e){if(e.currentTarget.scrollTop===0){e.currentTarget.scrollTop=1}else if(e.currentTarget.scrollHeight===e.currentTarget.scrollTop+e.currentTarget.offsetHeight){e.currentTarget.scrollTop-=1}});e("body").on("touchmove",".viewport",function(e){e.stopPropagation()});e(".viewport").bind("mousewheel DOMMouseScroll",function(t){var n=null;if(t.type=="mousewheel"){n=t.originalEvent.wheelDelta*-1}else if(t.type=="DOMMouseScroll"){n=40*t.originalEvent.detail}if(n){t.preventDefault();e(this).scrollTop(n+e(this).scrollTop())}});e.fn.flexpanel.toggle=function(){d.slide()};e.fn.flexpanel.open=function(){d.slide("open")};e.fn.flexpanel.close=function(){d.slide("close")}};e.fn.flexpanel=function(t){new e.flexpanel(this,t)}})(jQuery)